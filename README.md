# Toukatsu-kyoku Goetia System

> 统括局·盖提亚系统 - 分布式计算机视觉训练与实验管理平台

---

## 项目概述

Toukatsu-kyoku Goetia System 是一个面向计算机视觉任务的分布式深度学习训练平台。系统采用 Master-Agent 架构，支持将训练任务调度至多个远程 GPU 节点执行，并通过统一的 Web 界面进行任务配置、实时监控、实验对比与模型导出。

### 设计目标

| 目标         | 描述                                            |
| ---------- | --------------------------------------------- |
| **分布式训练**  | 支持多节点 GPU 资源池化管理与任务调度                         |
| **零侵入扩展**  | 模型、数据集、损失函数、评估指标热插拔注册                         |
| **完整实验追踪** | 自动记录环境、配置、指标，生成可复现脚本                          |
| **一键模型导出** | 支持 ONNX / TensorRT / OpenVINO / CoreML / NCNN |
| **智能报告生成** | 基于大模型 API 自动生成实验报告                            |
| **可视化分析**  | 特征图、梯度流、混淆矩阵、PR/ROC 曲线自动生成                    |

### 适用场景

* 图像分类 (Image Classification)
* 目标检测 (Object Detection)
* 语义分割 (Semantic Segmentation)
* 实例分割 (Instance Segmentation)

---

## 核心特性

### 1. 分布式训练管理

```
┌─────────────────────────────────────────────────────────────────┐
│                        GPU 资源池                                │
├─────────────────┬─────────────────┬─────────────────────────────┤
│   AutoDL-01    │   AutoDL-02    │      Featurize-01           │
│   RTX 4090     │   RTX 3090     │        A100 40GB            │
│   空闲 ●        │   训练中 ●      │        空闲 ●               │
└─────────────────┴─────────────────┴─────────────────────────────┘
```

* **多节点管理**：同时管理多个云端 GPU 节点（AutoDL、Featurize、自建服务器）
* **智能调度**：根据 GPU 显存、任务优先级自动分配节点
* **自动重连**：Agent 断线后自动重连，支持任务断点续传
* **预计时长**：基于历史数据预估训练完成时间

### 2. 混合精度与分布式自动处理

```yaml
training:
  distributed:
    enabled: true
    backend: nccl
    world_size: auto
  mixed_precision:
    enabled: true
    dtype: fp16
    grad_scaler: true
  gradient_accumulation:
    steps: 4
```

* 自动检测多卡环境并启用 DistributedDataParallel
* 混合精度训练 (FP16/BF16) 自动配置
* 梯度累积模拟大 Batch Size

### 3. 实验管理与复现

```
experiments/
└── exp_20250627_143052_a3b8c9d2/          # 唯一实验ID
    ├── config.yaml                         # 完整配置快照
    ├── environment.json                    # CUDA/cuDNN/PyTorch/GPU 信息
    ├── reproduce.sh                        # 一键复现脚本
    ├── checkpoints/
    │   ├── best_acc_0.9523_epoch_85.pth
    │   ├── last.pth
    │   └── checkpoint_epoch_50.pth
    ├── logs/
    │   ├── train.log
    │   ├── metrics.json
    │   └── tensorboard/
    ├── visualizations/
    │   ├── confusion_matrix.png
    │   ├── pr_curve.png
    │   ├── roc_curve.png
    │   ├── feature_maps/
    │   └── gradient_stats/
    └── exports/
        ├── model.onnx
        └── model_int8.trt
```

**自动记录内容**：

* CUDA / cuDNN / PyTorch / torchvision 版本
* GPU 型号、驱动版本、显存大小
* 完整配置文件快照
* Git commit hash（如有）
* 随机种子

**一键复现脚本示例**：

```bash
#!/bin/bash
# Reproduce script for exp_20250627_143052_a3b8c9d2
# Generated at 2025-06-27 14:30:52

export CUDA_VISIBLE_DEVICES=0
export PYTHONHASHSEED=42

python train.py \
    --config ./config.yaml \
    --seed 42 \
    --resume ./checkpoints/last.pth  # 可选
```

### 4. 模型导出与压缩

| 导出格式     | 用途                | 支持量化        |
| -------- | ----------------- | ----------- |
| ONNX     | 通用交换格式            | ✓ INT8      |
| TensorRT | NVIDIA GPU 部署     | ✓ FP16/INT8 |
| OpenVINO | Intel CPU/GPU/VPU | ✓ INT8      |
| CoreML   | Apple 设备          | ✓           |
| NCNN     | 移动端               | ✓           |

**模型压缩选项**：

* **量化**：PTQ (训练后量化) / QAT (量化感知训练)
* **剪枝**：结构化剪枝 / 非结构化剪枝
* **蒸馏**：特征蒸馏 / Logit 蒸馏 / 关系蒸馏

### 5. 可视化与分析

```
┌─────────────────────────────────────────────────────────────────┐
│                        可视化能力                                │
├─────────────────────────────────────────────────────────────────┤
│  📊 训练曲线    Loss / Accuracy / Learning Rate 实时曲线        │
│  📈 指标曲线    Precision / Recall / F1 / mAP 变化趋势          │
│  🔥 特征图      各层 Activation Map / CAM / Grad-CAM           │
│  📉 梯度统计    梯度分布 / 梯度流 / 梯度范数                      │
│  🎯 混淆矩阵    分类任务自动生成                                  │
│  📐 PR/ROC     Precision-Recall / ROC 曲线自动计算              │
│  🏗️ 模型结构   网络架构可视化                                    │
│  🔗 模型血缘   训练 → 微调 → 蒸馏 → 导出 全链路追踪              │
└─────────────────────────────────────────────────────────────────┘
```

### 6. 智能报告生成

通过大模型 API 自动分析实验结果并生成报告：

```
┌─────────────────────────────────────────────────────────────────┐
│                    实验报告 (自动生成)                           │
├─────────────────────────────────────────────────────────────────┤
│  📋 实验概述                                                    │
│  ├── 任务类型、模型结构、数据集信息                               │
│  ├── 训练配置摘要                                                │
│  └── 最终指标汇总                                                │
│                                                                 │
│  📊 训练过程分析                                                 │
│  ├── Loss 收敛情况分析                                           │
│  ├── 过拟合/欠拟合判断                                           │
│  └── 学习率调度效果                                              │
│                                                                 │
│  📈 性能评估                                                     │
│  ├── 各类别精度分析                                              │
│  ├── 混淆矩阵解读                                                │
│  └── 与 Baseline 对比                                           │
│                                                                 │
│  🔧 模型分析                                                     │
│  ├── 参数量 / FLOPs / 推理速度                                   │
│  └── 导出模型精度一致性验证                                       │
│                                                                 │
│  💡 改进建议                                                     │
│  └── 基于当前结果的优化方向                                       │
└─────────────────────────────────────────────────────────────────┘
```

输出格式：**Markdown** / **PDF**

### 7. 实验对比

```
┌─────────────────────────────────────────────────────────────────┐
│  实验对比视图                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │     📈 Accuracy 曲线对比 (可拖拽缩放)                     │   │
│  │                                                          │   │
│  │   ──── Exp-A: ResNet50 + SGD                            │   │
│  │   ──── Exp-B: ResNet50 + AdamW                          │   │
│  │   ──── Exp-C: ResNet101 + AdamW                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │     📝 配置差异对比 (高亮显示不同项)                       │   │
│  │                                                          │   │
│  │   optimizer:        SGD   │ AdamW  │ AdamW              │   │
│  │   learning_rate:    0.01  │ 0.001  │ 0.001              │   │
│  │   backbone:         res50 │ res50  │ res101  ← 差异     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 模块详解

### Master 模块

Master 运行于本地或中控服务器，负责全局管理与调度。

| 子模块                | 功能                           |
| ------------------ | ---------------------------- |
| `node_manager`     | Agent 节点注册、状态监控、GPU 资源池管理    |
| `task_scheduler`   | 任务队列管理、优先级调度、预计时长估算          |
| `connection`       | WebSocket 服务端、心跳检测、断线重连      |
| `data_aggregator`  | 指标收集、日志聚合、Checkpoint 管理      |
| `packager`         | 依赖分析、代码打包、任务包发送              |
| `protocol`         | 通信协议定义、消息序列化                 |
| `security`         | Token 管理、Agent 认证、传输加密       |
| `report_generator` | LLM 客户端、报告构建、PDF/Markdown 导出 |

### Agent 模块

Agent 部署于远程 GPU 节点，负责接收任务并执行训练。

| 子模块            | 功能                            |
| -------------- | ----------------------------- |
| `connection`   | WebSocket 客户端、心跳上报、自动重连       |
| `executor`     | 任务接收、包解压、动态加载、训练执行            |
| `reporter`     | 环境上报、指标上报、日志流推送、Checkpoint 上传 |
| `data_handler` | 数据集下载、解压、路径映射、格式校验            |
| `runtime_core` | 训练器基类、评估器、Hook 管理、混合精度、分布式    |

### Components 组件库

组件库存储于 Master 端，按需打包发送至 Agent。

| 组件类型            | 内容                                                        |
| --------------- | --------------------------------------------------------- |
| `models`        | Backbone (ResNet/ViT/Swin...)、Neck (FPN/PAN...)、Head、完整模型 |
| `datasets`      | COCO/VOC/YOLO/ImageNet 格式解析、Sampler                       |
| `augmentations` | 几何变换、光度变换、Mixup/CutMix/Mosaic                             |
| `losses`        | 分类/检测/分割损失函数、蒸馏损失                                         |
| `metrics`       | Accuracy/mAP/mIoU/混淆矩阵/PR曲线                               |
| `optimizers`    | SGD/Adam/AdamW/Lion                                       |
| `schedulers`    | StepLR/CosineAnnealing/Warmup                             |
| `hooks`         | Checkpoint/Logger/EarlyStopping/EMA/Profiler              |
| `compression`   | 量化/剪枝/蒸馏                                                  |

### Export 模块

| 子模块          | 功能                                     |
| ------------ | -------------------------------------- |
| `*_exporter` | ONNX/TensorRT/OpenVINO/CoreML/NCNN 导出器 |
| `optimizers` | ONNX 图优化、Shape 推断                      |
| `validators` | 精度验证、性能测试、一致性检查                        |

### Visualization 模块

| 子模块            | 功能                              |
| -------------- | ------------------------------- |
| `feature_maps` | 激活提取、特征可视化、CAM/Grad-CAM         |
| `gradients`    | 梯度提取、梯度流可视化                     |
| `statistics`   | Activation/Gradient/Weight 统计分布 |
| `metrics`      | 曲线绘制、混淆矩阵、PR/ROC 曲线             |
| `model`        | 架构可视化、模型血缘图                     |

### Analysis 模块

| 子模块          | 功能                             |
| ------------ | ------------------------------ |
| `profiler`   | FLOPs/Params/Memory/Latency 分析 |
| `benchmark`  | 推理速度测试、吞吐量测试                   |
| `comparison` | 实验对比、配置差异、指标对比                 |

### Experiment 模块

| 子模块            | 功能                      |
| -------------- | ----------------------- |
| `tracker`      | 实验追踪、指标记录、产出物管理         |
| `reproducer`   | 环境捕获、命令生成、种子管理          |
| `storage`      | 实验存储、Checkpoint 存储、云端同步 |
| `id_generator` | 唯一实验 ID 生成、路径解析         |

### Registry 模块

全局注册器，支持组件热插拔：

```python
from registry import MODELS, DATASETS, LOSSES, METRICS

@MODELS.register_module()
class MyCustomModel(nn.Module):
    ...

@DATASETS.register_module()
class MyCustomDataset(BaseDataset):
    ...
```

### API 模块

RESTful API + WebSocket 实时通信：

| 路由组                  | 功能         |
| -------------------- | ---------- |
| `/api/tasks`         | 任务创建/查询/控制 |
| `/api/nodes`         | 节点管理/状态查询  |
| `/api/experiments`   | 实验查询/对比/导出 |
| `/api/export`        | 模型导出任务     |
| `/api/reports`       | 报告生成/下载    |
| `/api/visualization` | 可视化数据获取    |
| `/ws/monitor`        | 实时指标/日志推送  |

### WebUI 模块

基于 Vue 3 + Vite + TailwindCSS 构建：

| 页面                  | 功能             |
| ------------------- | -------------- |
| Dashboard           | 系统概览、GPU 资源池状态 |
| TaskCreate          | 任务创建向导（多步骤表单）  |
| TaskMonitor         | 训练仪表盘、性能仪表盘    |
| ExperimentCompare   | 多实验曲线对比、配置差异   |
| ExportCenter        | 模型导出、格式选择、量化配置 |
| ReportViewer        | 报告预览、PDF 下载    |
| VisualizationCenter | 特征图、梯度、曲线查看    |

### Database 模块

| 存储类型                 | 用途                  |
| -------------------- | ------------------- |
| 本地 SQLite/PostgreSQL | 任务、节点、实验元数据         |
| 云端 MySQL             | 按实验 ID 同步配置与指标      |
| 文件系统                 | Checkpoint、日志、可视化图片 |

支持 **CSV 一键导出**。

---

## 交互流程

### 完整训练任务流程

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              用户操作流程                                     │
└──────────────────────────────────────────────────────────────────────────────┘

 ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
 │ Step 1  │────▶│ Step 2  │────▶│ Step 3  │────▶│ Step 4  │────▶│ Step 5  │
 │ 创建任务 │     │ 选择模型 │     │ 配置数据 │     │ 设置训练 │     │ 选择节点 │
 └─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘
      │                                                               │
      │  ┌─────────────────────────────────────────────────────────┐ │
      │  │  • 任务类型: 分类/检测/分割                              │ │
      │  │  • 任务名称与描述                                        │ │
      │  └─────────────────────────────────────────────────────────┘ │
      │                                                               │
      │  ┌─────────────────────────────────────────────────────────┐ │
      │  │  • Backbone: ResNet50 / ViT / Swin...                   │ │
      │  │  • Neck: FPN / PAN (检测/分割)                          │ │
      │  │  • Head: 自动匹配                                        │ │
      │  │  • 预训练权重: ImageNet / 自定义 / 无                    │ │
      │  └─────────────────────────────────────────────────────────┘ │
      │                                                               │
      │  ┌─────────────────────────────────────────────────────────┐ │
      │  │  • 数据格式: COCO / VOC / YOLO / ImageNet               │ │
      │  │  • 数据路径: 支持多路径输入                              │ │
      │  │  • 数据增强: Pipeline 可视化配置                         │ │
      │  └─────────────────────────────────────────────────────────┘ │
      │                                                               │
      │  ┌─────────────────────────────────────────────────────────┐ │
      │  │  • 损失函数 / 评估指标                                   │ │
      │  │  • 优化器 / 学习率调度                                   │ │
      │  │  • Epochs / Batch Size / 早停                           │ │
      │  │  • 分布式 / 混合精度 / 梯度累积                          │ │
      │  │  • 导出格式 / 量化选项                                   │ │
      │  └─────────────────────────────────────────────────────────┘ │
      │                                                               │
      │  ┌─────────────────────────────────────────────────────────┐ │
      │  │  • 自动分配 / 手动选择                                   │ │
      │  │  • GPU 显存筛选                                          │ │
      │  └─────────────────────────────────────────────────────────┘ │
      │                                                               ▼
      │                                                        ┌───────────┐
      └───────────────────────────────────────────────────────▶│  提交任务  │
                                                               └───────────┘
                                                                      │
                                                                      ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              系统处理流程                                     │
└──────────────────────────────────────────────────────────────────────────────┘

 ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
 │ Master  │────▶│ Packager│────▶│  Send   │────▶│  Agent  │────▶│ Execute │
 │ 验证配置 │     │ 依赖分析 │     │ 发送任务 │     │ 接收解压 │     │ 执行训练 │
 └─────────┘     │ 代码打包 │     └─────────┘     │ 下载数据 │     └─────────┘
                 └─────────┘                      │ 校验格式 │           │
                                                  └─────────┘           │
                                                                        ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              监控仪表盘                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   任务: ResNet50-COCO-Classification          状态: 训练中 ●                 │
│   实验ID: exp_20250627_143052_a3b8c9d2        节点: AutoDL-01               │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   进度: [████████████████░░░░░░░░░░░░░░]  52%     Epoch: 52/100             │
│   预计剩余: 1h 23min                                                         │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   ┌────────────────────────┐    ┌────────────────────────┐                  │
│   │   📉 Loss 曲线          │    │   📈 Accuracy 曲线      │                  │
│   │                        │    │                        │                  │
│   │   Train ────           │    │   Train ────           │                  │
│   │   Val   ----           │    │   Val   ----           │                  │
│   └────────────────────────┘    └────────────────────────┘                  │
│                                                                              │
│   ┌────────────────────────┐    ┌────────────────────────┐                  │
│   │   🖥️ GPU 利用率         │    │   💾 显存使用           │                  │
│   │   ████████████░░ 85%   │    │   18.5 / 24 GB         │                  │
│   └────────────────────────┘    └────────────────────────┘                  │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   当前指标:  Loss=0.234   Acc=0.891   LR=0.00032                            │
│   最佳指标:  Acc=0.895 @ Epoch 48  ⭐                                        │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   实时日志:                                                                  │
│   │ [14:32:15] Epoch 52/100, Batch 256/500, Loss: 0.231, Acc: 0.893        │
│   │ [14:32:18] Epoch 52/100, Batch 257/500, Loss: 0.228, Acc: 0.895        │
│   │ [14:32:21] Epoch 52/100, Batch 258/500, Loss: 0.225, Acc: 0.897        │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│           [⏸ 暂停]    [⏹ 停止]    [📊 详情]    [📥 下载日志]                  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼ 训练完成
┌──────────────────────────────────────────────────────────────────────────────┐
│                              训练完成                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   任务: ResNet50-COCO-Classification          状态: 已完成 ✓                 │
│   实验ID: exp_20250627_143052_a3b8c9d2        耗时: 2h 45min                │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   最终指标:                                                                  │
│   ┌──────────────┬──────────────┬──────────────┬──────────────┐             │
│   │   Accuracy   │  Precision   │    Recall    │      F1      │             │
│   │    0.9125    │    0.9083    │    0.9156    │    0.9119    │             │
│   └──────────────┴──────────────┴──────────────┴──────────────┘             │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   产出物:                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  📦 best_acc_0.9125_epoch_92.pth   (89.2MB)    [下载] [导出ONNX]    │   │
│   │  📦 last.pth                        (89.2MB)    [下载]              │   │
│   │  📄 training_log.json                           [下载] [查看]       │   │
│   │  📊 metrics_history.csv                         [下载] [可视化]     │   │
│   │  🖼️ confusion_matrix.png                        [查看]              │   │
│   │  📈 pr_curve.png                                [查看]              │   │
│   │  📈 roc_curve.png                               [查看]              │   │
│   │  📋 experiment_report.pdf                       [下载] [预览]       │   │
│   │  🔄 reproduce.sh                                [下载] [复制命令]   │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   模型分析:                                                                  │
│   ┌──────────────┬──────────────┬──────────────┬──────────────┐             │
│   │   Params     │    FLOPs     │   Latency    │    Memory    │             │
│   │   25.6M      │    4.1G      │    12.3ms    │    1.2GB     │             │
│   └──────────────┴──────────────┴──────────────┴──────────────┘             │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   [🗑 删除任务]  [🔄 重新训练]  [📈 基于此微调]  [📊 对比实验]  [📤 导出模型]   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 模型导出流程

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              模型导出中心                                     │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   源模型: exp_20250627_143052_a3b8c9d2/best_acc_0.9125_epoch_92.pth         │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   选择导出格式:                                                              │
│   ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌──────────┐  │
│   │   ONNX     │ │ TensorRT   │ │ OpenVINO   │ │  CoreML    │ │  NCNN    │  │
│   │    ✓       │ │     ✓      │ │            │ │            │ │          │  │
│   └────────────┘ └────────────┘ └────────────┘ └────────────┘ └──────────┘  │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   量化配置:                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  [✓] 启用量化                                                        │   │
│   │                                                                      │   │
│   │  量化方法:  ○ PTQ (训练后量化)    ● QAT (量化感知训练)               │   │
│   │  精度:      ○ FP16               ● INT8                             │   │
│   │  校准数据:  [使用验证集前 1000 张]                                   │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   输入规格:                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  Input Name:  image                                                  │   │
│   │  Input Shape: [1, 3, 224, 224]    [✓] 动态 Batch                    │   │
│   │  Input Type:  float32                                                │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│                    [取消]                    [开始导出]                      │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              导出进度                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ONNX 导出:                                                                 │
│   [████████████████████████████████████████] 100%  ✓ 完成                   │
│                                                                              │
│   ONNX 优化:                                                                 │
│   [████████████████████████████████████████] 100%  ✓ 完成                   │
│                                                                              │
│   TensorRT 转换:                                                             │
│   [████████████████████████░░░░░░░░░░░░░░░░]  60%  构建 Engine...           │
│                                                                              │
│   INT8 校准:                                                                 │
│   [████████████████░░░░░░░░░░░░░░░░░░░░░░░░]  40%  处理校准数据...           │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              导出结果                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   导出成功 ✓                                                                 │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   精度验证:                                                                  │
│   ┌────────────────┬────────────────┬────────────────┬───────────────────┐  │
│   │     格式       │   原始精度      │   导出精度      │     精度损失      │  │
│   ├────────────────┼────────────────┼────────────────┼───────────────────┤  │
│   │   PyTorch      │    91.25%      │       -        │        -          │  │
│   │   ONNX FP32    │       -        │    91.25%      │     0.00%         │  │
│   │   TensorRT FP16│       -        │    91.22%      │     0.03%         │  │
│   │   TensorRT INT8│       -        │    90.87%      │     0.38%         │  │
│   └────────────────┴────────────────┴────────────────┴───────────────────┘  │
│                                                                              │
│   性能对比:                                                                  │
│   ┌────────────────┬────────────────┬────────────────┬───────────────────┐  │
│   │     格式       │   推理延迟      │     吞吐量     │     模型大小       │  │
│   ├────────────────┼────────────────┼────────────────┼───────────────────┤  │
│   │   PyTorch      │    12.3ms      │    81 img/s    │     97.8 MB       │  │
│   │   ONNX FP32    │     8.7ms      │   115 img/s    │     97.5 MB       │  │
│   │   TensorRT FP16│     3.2ms      │   312 img/s    │     48.9 MB       │  │
│   │   TensorRT INT8│     1.8ms      │   555 img/s    │     25.1 MB       │  │
│   └────────────────┴────────────────┴────────────────┴───────────────────┘  │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   导出文件:                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  📦 model.onnx                    (97.5MB)     [下载]               │   │
│   │  📦 model_fp16.trt                (48.9MB)     [下载]               │   │
│   │  📦 model_int8.trt                (25.1MB)     [下载]               │   │
│   │  📦 calibration_cache.bin         (1.2KB)      [下载]               │   │
│   │  📄 export_config.json                         [下载]               │   │
│   │  📄 validation_report.json                     [下载]               │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│                          [关闭]            [下载全部]                        │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 实验对比流程

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              实验对比                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   选择对比实验 (已选 3 个):                                                   │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  [✓] exp_20250627_143052_a3b8c9d2  ResNet50 + AdamW     Acc: 91.25% │   │
│   │  [✓] exp_20250625_091023_b7c2d4e1  ResNet50 + SGD       Acc: 89.73% │   │
│   │  [✓] exp_20250626_182341_c9d3e5f2  ResNet101 + AdamW    Acc: 92.18% │   │
│   │  [ ] exp_20250624_154532_d1e4f6a3  ViT-Base + AdamW     Acc: 90.52% │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│                                 [开始对比]                                   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              对比结果                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     📈 Accuracy 曲线对比                             │   │
│   │                        (可拖拽选中时间段放大)                         │   │
│   │                                                                      │   │
│   │     1.0 ┤                                              ___──────    │   │
│   │         │                                        __──── ─ ─ ─ ─     │   │
│   │     0.9 ┤                               ___──────  ────────────     │   │
│   │         │                         __────  ─ ─ ─                     │   │
│   │     0.8 ┤                   __────  ────                            │   │
│   │         │              _────  ─ ─                                   │   │
│   │     0.7 ┤        __────                                             │   │
│   │         │   _────                                                   │   │
│   │     0.6 ┤────                                                       │   │
│   │         └────────┬────────┬────────┬────────┬────────┬────────▶    │   │
│   │                  20       40       60       80      100   Epoch     │   │
│   │                                                                      │   │
│   │         ──── ResNet50+AdamW   ─ ─ ─ ResNet50+SGD   ──── ResNet101   │   │
│   │                                                                      │   │
│   │                        [🔍 缩放] [↻ 重置] [📥 导出图片]               │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     📉 Loss 曲线对比                                 │   │
│   │                                                                      │   │
│   │     2.5 ┤────                                                       │   │
│   │         │   ────__                                                  │   │
│   │     2.0 ┤        ────__                                             │   │
│   │         │              ────__                                       │   │
│   │     1.5 ┤                    ────__                                 │   │
│   │         │                          ────__                           │   │
│   │     1.0 ┤                                ────__                     │   │
│   │         │                                      ────____             │   │
│   │     0.5 ┤                                              ────────     │   │
│   │         └────────┬────────┬────────┬────────┬────────┬────────▶    │   │
│   │                  20       40       60       80      100   Epoch     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   📊 指标汇总:                                                               │
│   ┌────────────────┬────────────────┬────────────────┬───────────────────┐  │
│   │     实验       │   Accuracy     │   Precision    │      Recall       │  │
│   ├────────────────┼────────────────┼────────────────┼───────────────────┤  │
│   │ ResNet50+AdamW │    91.25%      │    90.83%      │      91.56%       │  │
│   │ ResNet50+SGD   │    89.73%      │    89.21%      │      90.12%       │  │
│   │ ResNet101+AdamW│    92.18% ⭐   │    91.95% ⭐   │      92.34% ⭐    │  │
│   └────────────────┴────────────────┴────────────────┴───────────────────┘  │
│                                                                              │
│  ────────────────────────────────────────────────────────────────────────   │
│                                                                              │
│   📝 配置差异 (高亮显示不同项):                                               │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                    │  ResNet50+AdamW  │  ResNet50+SGD  │ ResNet101  │   │
│   │────────────────────┼──────────────────┼────────────────┼────────────│   │
│   │ model.backbone     │    resnet50      │    resnet50    │ resnet101  │ ← │
│   │ optimizer.type     │    AdamW         │    SGD         │ AdamW      │ ← │
│   │ optimizer.lr       │    0.001         │    0.01        │ 0.001      │ ← │
│   │ optimizer.weight_d │    0.05          │    0.0001      │ 0.05       │ ← │
│   │ scheduler.type     │    cosine        │    step        │ cosine     │ ← │
│   │ training.epochs    │    100           │    100         │ 100        │   │
│   │ training.batch_size│    32            │    32          │ 32         │   │
│   │────────────────────┴──────────────────┴────────────────┴────────────│   │
│   │                                              ← 表示该行存在差异         │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   🖥️ 资源消耗对比:                                                           │
│   ┌────────────────┬────────────────┬────────────────┬───────────────────┐  │
│   │     实验       │   训练时长      │   GPU 显存      │    Params        │  │
│   ├────────────────┼────────────────┼────────────────┼───────────────────┤  │
│   │ ResNet50+AdamW │    2h 45min    │    12.3 GB     │      25.6M        │  │
│   │ ResNet50+SGD   │    2h 38min    │    12.3 GB     │      25.6M        │  │
│   │ ResNet101+AdamW│    4h 12min    │    18.7 GB     │      44.5M        │  │
│   └────────────────┴────────────────┴────────────────┴───────────────────┘  │
│                                                                              │
│         [📥 导出 CSV]    [📄 生成对比报告]    [🔗 分享链接]    [关闭]          │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### Master-Agent 通信流程

```
┌───────────────────┐                              ┌───────────────────┐
│      Master       │                              │       Agent       │
│   (本地/中控)      │                              │   (云端GPU节点)    │
└─────────┬─────────┘                              └─────────┬─────────┘
          │                                                  │
          │  ◀──────────── WebSocket 连接请求 ────────────────│
          │                                                  │
          │─────────────── Token 验证请求 ────────────────────▶
          │                                                  │
          │  ◀──────────── Agent 信息上报 ────────────────────│
          │                (GPU型号/显存/CUDA版本)            │
          │                                                  │
          │─────────────── 注册确认 ──────────────────────────▶
          │                                                  │
          │                    ...                           │
          │                                                  │
          │  ◀──────────── 心跳包 (每30s) ────────────────────│
          │                (GPU利用率/显存/温度)              │
          │                                                  │
          │─────────────── 心跳响应 ──────────────────────────▶
          │                                                  │
          │                    ...                           │
          │                                                  │
          │─────────────── 任务下发 ──────────────────────────▶
          │                (config + 代码包)                  │
          │                                                  │
          │  ◀──────────── 任务接收确认 ──────────────────────│
          │                                                  │
          │  ◀──────────── 数据下载进度 ──────────────────────│
          │                (10%...50%...100%)                │
          │                                                  │
          │  ◀──────────── 训练开始通知 ──────────────────────│
          │                                                  │
          │  ◀──────────── 实时指标 (每N步) ──────────────────│
          │                (loss/acc/lr/gpu_util)            │
          │                                                  │
          │  ◀──────────── 日志流 ────────────────────────────│
          │                                                  │
          │  ◀──────────── Epoch 完成通知 ────────────────────│
          │                (eval metrics)                    │
          │                                                  │
          │  ◀──────────── Checkpoint 上传 ───────────────────│
          │                (best/periodic)                   │
          │                                                  │
          │  ◀──────────── 可视化数据 ────────────────────────│
          │                (feature maps/gradients)          │
          │                                                  │
          │                    ...                           │
          │                                                  │
          │  ◀──────────── 训练完成通知 ──────────────────────│
          │                (final metrics + artifacts)       │
          │                                                  │
          │─────────────── 导出任务下发 ──────────────────────▶
          │                                                  │
          │  ◀──────────── 导出进度 ──────────────────────────│
          │                                                  │
          │  ◀──────────── 导出文件上传 ──────────────────────│
          │                                                  │
          │─────────────── 任务结束确认 ──────────────────────▶
          │                                                  │
          ▼                                                  ▼
```

---

## 配置系统

### Hydra 配置架构

系统采用 Hydra 配置框架，支持配置组合、覆盖与多运行。

```
configs/
├── hydra/                          # Hydra 核心
│   ├── config_loader.py
│   ├── config_composer.py
│   └── config_validator.py
│
├── defaults/                       # 默认配置
│   ├── model.yaml
│   ├── dataset.yaml
│   ├── optimizer.yaml
│   ├── scheduler.yaml
│   ├── augmentation.yaml
│   ├── training.yaml
│   ├── export.yaml
│   └── compression.yaml
│
├── groups/                         # 配置组
│   ├── backbone/
│   │   ├── resnet50.yaml
│   │   ├── resnet101.yaml
│   │   ├── vit_base.yaml
│   │   └── swin_tiny.yaml
│   ├── neck/
│   ├── head/
│   ├── loss/
│   └── metric/
│
├── templates/                      # 任务模板
│   ├── classification/
│   ├── detection/
│   └── segmentation/
│
└── schemas/                        # 配置校验 Schema
    ├── model_schema.py
    ├── dataset_schema.py
    └── training_schema.py
```

### 完整配置示例

```yaml
# experiment_config.yaml

# ==================== 基础信息 ====================
experiment:
  name: "resnet50_imagenet_classification"
  description: "ResNet50 在 ImageNet 子集上的分类实验"
  tags: ["classification", "resnet", "baseline"]
  seed: 42

# ==================== 模型配置 ====================
model:
  type: "ImageClassifier"
  
  backbone:
    type: "ResNet"
    depth: 50
    num_stages: 4
    out_indices: [3]
    frozen_stages: -1
    norm_cfg:
      type: "BN"
      requires_grad: true
    style: "pytorch"
  
  neck: null
  
  head:
    type: "LinearClsHead"
    num_classes: 1000
    in_channels: 2048
    loss:
      type: "CrossEntropyLoss"
      loss_weight: 1.0
      label_smoothing: 0.1
    topk: [1, 5]

  # 预训练权重
  pretrained:
    enabled: true
    source: "torchvision"  # torchvision / timm / url / local
    path: "ResNet50_Weights.IMAGENET1K_V2"
    strict: false

# ==================== 数据集配置 ====================
dataset:
  type: "ImageNet"
  
  # 支持多路径（数据不在项目目录）
  data_roots:
    - "/data/datasets/imagenet/train"
    - "/mnt/nas/datasets/imagenet_extra/train"
  
  train:
    ann_file: "/data/datasets/imagenet/meta/train.txt"
    data_prefix: ""
    
  val:
    data_root: "/data/datasets/imagenet/val"
    ann_file: "/data/datasets/imagenet/meta/val.txt"
    data_prefix: ""
  
  test:
    data_root: "/data/datasets/imagenet/test"
    ann_file: null  # 无标注测试集

  # 类别信息
  num_classes: 1000
  classes_file: "/data/datasets/imagenet/meta/classes.txt"

# ==================== 数据增强 ====================
augmentation:
  train:
    pipeline:
      - type: "LoadImage"
      - type: "RandomResizedCrop"
        size: 224
        scale: [0.08, 1.0]
        ratio: [0.75, 1.333]
      - type: "RandomHorizontalFlip"
        prob: 0.5
      - type: "ColorJitter"
        brightness: 0.4
        contrast: 0.4
        saturation: 0.4
        hue: 0.1
      - type: "AutoAugment"
        policy: "imagenet"
      - type: "ToTensor"
      - type: "Normalize"
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
      - type: "RandomErasing"
        prob: 0.25
    
    # Batch 级增强
    batch_augments:
      - type: "Mixup"
        alpha: 0.8
        prob: 0.5
      - type: "CutMix"
        alpha: 1.0
        prob: 0.5
  
  val:
    pipeline:
      - type: "LoadImage"
      - type: "Resize"
        size: 256
      - type: "CenterCrop"
        size: 224
      - type: "ToTensor"
      - type: "Normalize"
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]

# ==================== 优化器 ====================
optimizer:
  type: "AdamW"
  lr: 0.001
  weight_decay: 0.05
  betas: [0.9, 0.999]
  
  # 层级学习率衰减
  layer_decay:
    enabled: true
    decay_rate: 0.65

# ==================== 学习率调度 ====================
scheduler:
  type: "CosineAnnealingLR"
  T_max: 100
  eta_min: 1.0e-6
  
  warmup:
    enabled: true
    type: "linear"
    epochs: 5
    start_factor: 0.001

# ==================== 训练配置 ====================
training:
  epochs: 100
  batch_size: 32
  num_workers: 8
  pin_memory: true
  
  # 分布式训练
  distributed:
    enabled: true
    backend: "nccl"
    find_unused_parameters: false
  
  # 混合精度
  mixed_precision:
    enabled: true
    dtype: "fp16"  # fp16 / bf16
    grad_scaler: true
  
  # 梯度累积
  gradient_accumulation:
    steps: 4
  
  # 梯度裁剪
  gradient_clip:
    enabled: true
    max_norm: 1.0
    norm_type: 2
  
  # 早停
  early_stopping:
    enabled: true
    monitor: "val/accuracy_top1"
    patience: 20
    mode: "max"
  
  # EMA
  ema:
    enabled: true
    decay: 0.9999

# ==================== 评估指标 ====================
metrics:
  - type: "Accuracy"
    topk: [1, 5]
  - type: "Precision"
    average: "macro"
  - type: "Recall"
    average: "macro"
  - type: "F1Score"
    average: "macro"
  - type: "ConfusionMatrix"
    num_classes: 1000

# ==================== Checkpoint ====================
checkpoint:
  save_dir: "auto"  # 自动生成: experiments/{exp_id}/checkpoints
  save_interval: 10
  save_best: true
  best_metric: "val/accuracy_top1"
  best_mode: "max"
  max_keep: 3
  save_last: true

# ==================== 日志 ====================
logging:
  log_dir: "auto"
  log_interval: 50
  
  writers:
    - type: "console"
    - type: "file"
    - type: "tensorboard"
    - type: "json"

# ==================== 可视化 ====================
visualization:
  enabled: true
  
  feature_maps:
    enabled: true
    layers: ["layer4"]
    samples: 10
  
  gradients:
    enabled: true
    interval: 500
  
  confusion_matrix:
    enabled: true
    normalize: true
  
  pr_curve:
    enabled: true
  
  roc_curve:
    enabled: true

# ==================== 模型分析 ====================
analysis:
  profiler:
    enabled: true
    count_flops: true
    count_params: true
    measure_latency: true
    latency_iterations: 100
  
  model_lineage:
    enabled: true

# ==================== 导出配置 ====================
export:
  enabled: true
  
  formats:
    - type: "onnx"
      opset_version: 17
      dynamic_axes:
        input: {0: "batch_size"}
        output: {0: "batch_size"}
    
    - type: "tensorrt"
      precision: "fp16"  # fp32 / fp16 / int8
      workspace_size: 4  # GB
      
    - type: "tensorrt"
      precision: "int8"
      calibration:
        method: "entropy"  # entropy / minmax
        num_samples: 1000
  
  input_spec:
    name: "input"
    shape: [1, 3, 224, 224]
    dtype: "float32"
  
  validation:
    enabled: true
    num_samples: 100
    tolerance: 0.001

# ==================== 压缩配置 (可选) ====================
compression:
  quantization:
    enabled: false
    method: "qat"  # ptq / qat
    precision: "int8"
  
  pruning:
    enabled: false
    method: "magnitude"
    sparsity: 0.5
    schedule: "cubic"
  
  distillation:
    enabled: false
    teacher:
      type: "ImageClassifier"
      checkpoint: "/path/to/teacher.pth"
    losses:
      - type: "KLDivLoss"
        weight: 0.5
        temperature: 4.0
      - type: "FeatureLoss"
        weight: 0.5
        layers: ["layer4"]

# ==================== 报告生成 ====================
report:
  enabled: true
  format: ["markdown", "pdf"]
  
  llm:
    provider: "openai"  # openai / anthropic / local
    model: "gpt-4"
    api_key: "${OPENAI_API_KEY}"  # 从环境变量读取
  
  sections:
    - experiment_summary
    - training_analysis
    - performance_evaluation
    - model_analysis
    - improvement_suggestions
```

### 配置覆盖机制

```bash
# 命令行覆盖
python train.py \
    --config configs/templates/classification/resnet50.yaml \
    model.backbone.depth=101 \
    optimizer.lr=0.0001 \
    training.batch_size=64

# 多配置组合
python train.py \
    --config configs/templates/classification/base.yaml \
    +backbone=resnet101 \
    +optimizer=adamw \
    +scheduler=cosine

# 多运行 (Sweep)
python train.py \
    --config configs/templates/classification/resnet50.yaml \
    --multirun \
    optimizer.lr=0.001,0.0001,0.00001 \
    training.batch_size=32,64
```

### 配置校验

系统启动时自动校验配置合法性：

```python
# 校验规则示例
class TrainingConfigSchema:
    epochs: int = Field(gt=0, le=10000)
    batch_size: int = Field(gt=0, le=1024)
    num_workers: int = Field(ge=0, le=32)
    
class OptimizerConfigSchema:
    type: Literal["SGD", "Adam", "AdamW", "Lion"]
    lr: float = Field(gt=0, le=10.0)
    weight_decay: float = Field(ge=0, le=1.0)
```

---

## 数据规范

### 支持的数据格式

#### 图像分类 (ImageNet 格式)

```
dataset/
├── train/
│   ├── class_001/
│   │   ├── img_0001.jpg
│   │   ├── img_0002.jpg
│   │   └── ...
│   ├── class_002/
│   │   └── ...
│   └── ...
├── val/
│   └── (同 train 结构)
├── test/
│   └── (同 train 结构，可无子目录)
└── meta/
    ├── train.txt          # 可选：image_path label
    ├── val.txt
    └── classes.txt        # 类别名称列表
```

**标注文件格式** (`train.txt`)：

```
train/class_001/img_0001.jpg 0
train/class_001/img_0002.jpg 0
train/class_002/img_0001.jpg 1
...
```

#### 目标检测 (COCO 格式)

```
dataset/
├── images/
│   ├── train/
│   │   ├── 000000000001.jpg
│   │   ├── 000000000002.jpg
│   │   └── ...
│   ├── val/
│   │   └── ...
│   └── test/
│       └── ...
└── annotations/
    ├── instances_train.json
    ├── instances_val.json
    └── image_info_test.json
```

**COCO JSON 格式**：

```json
{
  "info": {...},
  "licenses": [...],
  "images": [
    {
      "id": 1,
      "file_name": "000000000001.jpg",
      "width": 640,
      "height": 480
    }
  ],
  "annotations": [
    {
      "id": 1,
      "image_id": 1,
      "category_id": 1,
      "bbox": [100, 100, 200, 150],  // [x, y, width, height]
      "area": 30000,
      "iscrowd": 0,
      "segmentation": [[...]]  // 可选，用于实例分割
    }
  ],
  "categories": [
    {"id": 1, "name": "cat", "supercategory": "animal"},
    {"id": 2, "name": "dog", "supercategory": "animal"}
  ]
}
```

#### 目标检测 (VOC 格式)

```
dataset/
├── JPEGImages/
│   ├── 000001.jpg
│   ├── 000002.jpg
│   └── ...
├── Annotations/
│   ├── 000001.xml
│   ├── 000002.xml
│   └── ...
├── ImageSets/
│   └── Main/
│       ├── train.txt
│       ├── val.txt
│       └── trainval.txt
└── labels.txt
```

**VOC XML 格式**：

```xml
<annotation>
  <folder>JPEGImages</folder>
  <filename>000001.jpg</filename>
  <size>
    <width>640</width>
    <height>480</height>
    <depth>3</depth>
  </size>
  <object>
    <name>cat</name>
    <pose>Unspecified</pose>
    <truncated>0</truncated>
    <difficult>0</difficult>
    <bndbox>
      <xmin>100</xmin>
      <ymin>100</ymin>
      <xmax>300</xmax>
      <ymax>250</ymax>
    </bndbox>
  </object>
</annotation>
```

#### 目标检测 (YOLO 格式)

```
dataset/
├── images/
│   ├── train/
│   │   ├── img_0001.jpg
│   │   └── ...
│   └── val/
│       └── ...
├── labels/
│   ├── train/
│   │   ├── img_0001.txt
│   │   └── ...
│   └── val/
│       └── ...
├── data.yaml
└── classes.txt
```

**YOLO TXT 格式** (`img_0001.txt`)：

```
# class_id center_x center_y width height (归一化到 0-1)
0 0.5 0.4 0.3 0.2
1 0.2 0.6 0.1 0.15
```

**data.yaml**：

```yaml
path: /data/dataset
train: images/train
val: images/val
test: images/test

nc: 80
names: ['person', 'bicycle', 'car', ...]
```

#### 语义分割

```
dataset/
├── images/
│   ├── train/
│   │   ├── img_0001.jpg
│   │   └── ...
│   └── val/
│       └── ...
├── masks/
│   ├── train/
│   │   ├── img_0001.png  # 单通道，像素值为类别 ID
│   │   └── ...
│   └── val/
│       └── ...
└── classes.txt
```

**Mask 规范**：

* 格式：PNG (单通道 / 调色板模式)
* 像素值：0-N（N 为类别数-1）
* 忽略类别：通常为 255

#### 实例分割 (COCO 格式)

同目标检测 COCO 格式，`annotations` 中需包含 `segmentation` 字段：

```json
{
  "segmentation": [[x1,y1,x2,y2,...,xn,yn]],  // 多边形
  // 或 RLE 格式
  "segmentation": {
    "counts": "...",
    "size": [height, width]
  }
}
```

### 多数据源配置

支持数据不在项目目录的场景：

```yaml
dataset:
  type: "MultiSourceDataset"
  
  sources:
    - name: "primary"
      data_root: "/mnt/nas/datasets/coco"
      ann_file: "annotations/instances_train.json"
      weight: 1.0
    
    - name: "extra"
      data_root: "/data/external/objects365"
      ann_file: "annotations/train.json"
      weight: 0.5
      
    - name: "synthetic"
      data_root: "/data/generated/synthetic_v2"
      ann_file: "annotations/train.json"
      weight: 0.3
  
  # 采样策略
  sampling:
    strategy: "weighted"  # weighted / round_robin / concat
    resample_epoch: true
```

### 数据校验

系统提供数据格式校验工具：

```bash
# 校验数据集
python tools/validate_dataset.py \
    --format coco \
    --data_root /data/datasets/coco \
    --ann_file annotations/instances_train.json \
    --output validation_report.json
```

**校验内容**：

* 图像文件存在性检查
* 标注格式合法性
* 类别 ID 连续性
* bbox 坐标范围检查
* 图像尺寸一致性统计
* 类别分布统计

---

*Toukatsu-kyoku Goetia System v1.0*

*统括局·哥耶提亚系统 - 让深度学习训练更简单*
